\documentclass{article} \usepackage[utf8]{inputenc}
\pdfresettimer
\usepackage{xstring}
\usepackage{calc, xintexpr}
\usepackage{xfp}
\usepackage{pdftexcmds}
\usepackage{coolstr}
\usepackage{intcalc}
\usepackage{amsrefs}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage[most]{tcolorbox}
\usepackage{lipsum}
\usepackage{amsmath}
\usepackage{cprotect}

\setlength{\parskip}{\baselineskip}%
\setlength{\parindent}{0pt}%

% requires xstring
\input{sneakycode}


% https://tug.org/tug2019/slides/slides-ziegenhagen-python.pdf
\usepackage{fancyvrb}
\makeatletter
\newenvironment{pycode}[1]%
{\xdef\d@tn@me{#1}\xdef\r@ncmd{python #1.py > #1.plog}%
\typeout{Writing file #1}\VerbatimOut{#1.py}%
}
{\endVerbatimOut %
\toks0{\immediate\write18}%
\expandafter\toks\expandafter1\expandafter{\r@ncmd}%
 \edef\d@r@ncmd{\the\toks0{\the\toks1}}\d@r@ncmd %
 \noindent Input
 \inputminted{python}{\d@tn@me.py}%
 \noindent Output
 \inputminted{text}{\d@tn@me.plog}%
 }
 \makeatother


% quote backgrounds: https://tex.stackexchange.com/a/436253/102826
\definecolor{linequote}{RGB}{224,215,188}
\definecolor{backquote}{RGB}{249,245,233}

\newtcolorbox{myquote}{%
    enhanced, breakable, 
    size=fbox,
    frame hidden, boxrule=0pt,
    sharp corners,
    colback=backquote,
    borderline horizontal={.5pt}{0pt}{linequote},
    borderline horizontal={.5pt}{1pt}{linequote}
}

%% Important!!
%% Use ! before "O{}" with xparse 2018-05-12 
%% See: https://tex.stackexchange.com/q/434928/1952
\NewTCBListing{mycode}{ O{} }{%
    enhanced, breakable, 
    size=fbox,
    frame hidden, boxrule=0pt,
    sharp corners,
    colback=gray!30,
    listing only, 
    listing options={%
        style=tcblatex,
        keywordstyle=\color{brown!70!black},
        texcsstyle=*\color{brown!70!black}
    },
    #1}

% Inline Code customized https://stackoverflow.com/questions/3175105/writing-code-in-latex-document
\definecolor{codebggray}{rgb}{0.9,0.9,0.9}
\newcommand{\code}[1]{\colorbox{codebggray}{{\texttt{#1}}}}

% TeX docs at http://pgfplots.sourceforge.net/TeX-programming-notes.pdf

% TODO: https://tex.stackexchange.com/questions/29402/how-do-i-make-my-document-look-like-it-was-written-by-a-cthulhu-worshipping-madm
% cool hack: http://texhacks.blogspot.com/2010/12/forcing-full-expansion.html

\newif\ifdebug
\debugfalse
\newif\ifverbose
\verbosefalse
\newif\ifrunpartone
\runpartonefalse
\newif\ifrunparttwo
\runparttwofalse
\newif\ifrunshellex
\runshellexfalse
\newif\ifrunparttwotrytwo
\runparttwotrytwotrue

\title{Advent of Code\\
{\large Day Eight}}
\author{LucidBrot} \date{August 2020}
\input{input.tex}

% https://tex.stackexchange.com/a/7183/102826
% if is num, emphasize, else ignore.
\def\isnum#1{%
  \if!\ifnum9<1#1!\else_\fi
    \emph{#1}\else#1\fi}


\newcommand{\firstchar}[1]{%
    \StrLeft{#1}{1}[\firstletter]%
    \firstletter
}

% documentation: \getchar[hello]{5}   is 'h'
\def\getchar[#1]#2{%
\StrMid{#1}{#2}{\numexpr #2 + 0\relax}[\mychar]%
\mychar}

% same as getchar but maybe it works when used in string comparison?
\def\getcoolchar[#1]#2{%
\substr{#1}{#2}{1}%
}
% NOPE! It's just as broken, just in a different way. it works as long as the first argument is a string. but if it's a command... then it returns the whole thing as first character.

% https://tex.stackexchange.com/questions/195491/ifthenelse-equal-string-comparison-fails
\makeatletter
\newcommand\strcmptozero[1]{%
  \ifnum\pdf@strcmp{\unexpanded{#1}}{0}=0 %
     \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
    {TRUE}
    {FALSE}%
}
\makeatother

% modulo computation in plain TeX
% https://tex.stackexchange.com/a/34434/102826
\newcount\tmpcnta
\def\modulo#1#2{\tmpcnta=#1
        \divide\tmpcnta by #2
        \multiply\tmpcnta by #2
        \multiply\tmpcnta by -1
        \advance\tmpcnta by #1\relax
        \the\tmpcnta}

% https://tex.stackexchange.com/questions/402173/append-strings-to-a-variable-and-display-them-at-the-front-of-the-document
% used in part 2
\def\mystring{} % temp string
\def\thefinalstring{} % Saved in aux file
\makeatletter
\def\myappendstring#1{\g@addto@macro\mystring{ #1}}
\def\myappendxstring#1{\edef\tmp{#1}\expandafter\g@addto@macro\expandafter\mystring\expandafter{\tmp}}
\makeatother

\begin{document}


\maketitle

\section{About}
The task at \href{https://adventofcode.com/2019/day/8}{adventofcode 2019 day 8} is fairly straightforward itself. It can be summarized as \begin{myquote}\begin{quote}
Read the input line of $N$ numeric characters into \textit{layers} of size $width * height$ (which are known) to find the layer that contains the lowest number of zeros. Then return the number of \texttt{'1'} digits multiplied by the number of \texttt{'2'} digits within that layer.
\end{quote}\end{myquote}

However, we're doing this in \LaTeX , which is typeset in spongebob-case for a reason.

\begin{figure}[ht]
\begin{myquote}
\begin{quote}
"English words like ‘technology’ stem from a Greek root beginning with the letters
\TeX ...; and this same Greek word means art as well as technology. "
\end{quote}
\end{myquote}
\caption{-- Donald E. Knuth \citelist{\cite{texbook}}}
\end{figure}

\section{The \LaTeX\,\.E\.x\.p\.e\.r\.i\.e\.n\.c\.e}
First of all, we're doing something that it was not meant to be used for -- so that means we never get the search results we want. Searching about arrays in \LaTeX for example gives you an explanation about how to typeset matrices. Very useful, but not what I wanted. Thankfully, the \href{http://pgfplots.sourceforge.net/TeX-programming-notes.pdf}{pgfplots sourceforge page} contains a pdf with \textit{Notes On Programming in \TeX}.

Secondly, there don't seem to be any variables. Just \textit{counters}, \textit{counts} which are the \TeX version. and \textit{ifdefs} and most importantly \textit{macros}. But I did not read up on the internals of \TeX and \LaTeX, so I have no clue about the exact way that macros are evaluated. Sometimes you can define a command that works perfectly well for a constant argument, but if you dare use it on the result of another command, you're being had from multiple directions. Because that result has not already been evaluated (expanded) and is passed as-is into the other command. My version of pdfLaTex does not feature the primitive \texttt{\textbackslash expanded} yet. Using \texttt{\textbackslash expandafter} feels very clunky. Luckily there's a hack around that to be found \href{http://texhacks.blogspot.com/2010/12/forcing-full-expansion.html}{here}. And sometimes the problem was actually the \texttt{xstring} package which also breaks the hack.

\begin{samepage}
\begin{myquote}
\begin{quote}
The macros of this package are not purely expandable, i.e. they cannot be put in the argument of an \textbackslash edef. Nestling macros is not possible neither.

For this reason, all the macros returning a result (i.e. all excepted the tests) have an optional argument in last position. The syntax is \texttt{[ name ]}, where name is the name of the control sequence that will receive the result of the macro: the assignment is made with an \textbackslash edef which make the result of the macro name purely expandable. Of course, if an optional argument is present, the macro does not display anything.\citelist{\cite{Gonzalo}}
\end{quote}
\end{myquote}
\end{samepage}

After eliminating some problems of this sort by storing the result in a new command by virtue of the optional argument, the same problem still appeared because some commands just don't work due to the same issue, even if they are making use of the optional argument to return that in turn \hbox{(See Figure \ref{code:1}, \autoref{fig:diff}).}

(Btw, I have used \texttt{\textbackslash autoref} above, for the second figure reference, instead of \texttt{\textbackslash ref} and that is pretty cool.)

\begin{figure}[hbtp]
\begin{lstlisting}[language=TeX]
\def\getchar[#1]#2{%
\StrMid{#1}{#2}{\numexpr #2 + 0\relax}[\mychar]%
\mychar}
\end{lstlisting}
\caption{This command does not like to be used on a non-constant string.}
\label{code:1}
\end{figure}

\begin{figure}[hbt]
\makebox[\textwidth][c]{\includegraphics[width=1.6\textwidth]{diff}}%
  \caption{The difference between wrong code that compiles (red) and seemingly correct code that produces a compiler error (green).}
  \label{fig:diff}
\end{figure}

Finally, the performance of the \texttt{xstring} package is whack. It takes more than two minutes to figure out the length of a 15'000 character string. The bash command \texttt{wc -c inputfile.txt} does that in less than a second.
\clearpage
\section{StrLen}
Since \texttt{xstring}'s \texttt{StrLen} is so slow, how about creating a faster one?
We'll just have to run tex with the \texttt{--shell-escape} flag.\citelist{\cite{shellescape}} ( See \autoref{fig:typesettingsettings}). Using that allows us to escape to the shell - which is either bash or the windows cmd.exe.

\begin{figure}[htbp]
\includegraphics{typesettingsettings}
\caption{TeXworks settings for shellescape}
\label{fig:typesettingsettings}
\end{figure}

\begin{quote}
Somehow, pdflatex threads kept running despite me stopping them in TeXworks or even closing TeXworks. For further debugging, the rest of this section is skipped for now, hence. Currently, the section is being
\ifrunshellex
run.\\
\else
skipped.\\
\fi
But as it turned out, skipping this section about shellex helped nothing at all regarding this issue... It happened with the real input, but not with the \code{\textbackslash debug} input.
\end{quote}
\ifrunshellex % ifrunshellex

%\immediate\write18{wc -c inputfile.tex > scriptoutput.tex}
%Character Count: \input{scriptoutput.tex}
A simple \texttt{\textbackslash input\{|"echo test"\}} already works!
\input{|"echo test!"}

But I cannot figure out how to correctly call \texttt{wc -c inputfile.tex} because the shell spawns in the wrong path (\code{AppData/Local/Temp/mik53499/\_src }). And also, for some reason the following code does not even create a file \texttt{outfile.blubb} anywhere on my machine.
\begin{lstlisting}
\input{|"echo a > outfile.blubb"}
\end{lstlisting}
The problem seems to be, according to the logs, that the pipe closes before the left side is finished writing to stdout. But that is actually happening due to the \texttt{echo} earlier. When I leave it out, that's not logged.

Maybe using python is easier? You'd have to read the source to get this one though.\citelist{\cite{pythonescape}}
\begin{lstlisting}
\begin{pycode}{abc}
print(1+12)
\end{pycode}
\end{lstlisting}
But no, that also results in a problem with writing to a file... So let me try something I understand!
\begin{mycode}
\input{|"python -c "print(1+2);""}
\end{mycode}
\typeout{trying python}
\input{|"python -c "print(1+2);""}
~\newline
And as you should be able to see, it works!
It does output some \code{SyntaxError} in the Console output, but it seems like I can ignore that?!

So for computing stringlength, a quick python call should speed things up.
\begin{mycode}
\ input{|"python -c "print(len('mystringofunkownlength'));""}
\end{mycode}
\input{|"python -c "print(len('mystringofunkownlength'));""}
~\newline
It is notable that spaces within that string get lost before they are passed to python. Thankfully we don't need this here. But this reminds my of \href{https://ctftime.org/writeup/21982}{PyAuCalc}.
The loss of spacing also explains why some commands don't work. E.g. importing a python module without spaces is not trivial.

We can make \LaTeX\, paste a string into that as well...

\begin{mycode}
\def\mystr{hello}
\def\mystrtwo{\mystr}
\input{|"python -c "print(len('\mystrtwo'));""}
\end{mycode}
\def\mystr{hello}
\def\mystrtwo{\mystr}
\input{|"python -c "print(len('\mystrtwo'));""}
...but for some reason it fails when used with our included inputstring. There's a site with an example on how to include text from a file, but it does not work at all for me\citelist{\cite{stackexpand}}. I guess I'll just hardcode it inside this file here instead... For that, however, the line length limit becomes an issue. So I've declared 74 commands and combined them into one. Aand turns out that also didn't help. The string just ends after some two hundred characters.

So to quote a professor of mine, J. Hromkovic, 
\begin{quote}\textit{"\textbf{Strategy: We Give Up!} What can we do to still be able to state something impressive?"}\end{quote}
Well, I can just hardcode the damn string length. That's not really worse than hardcoding the input.

During Part 2, I'm revisiting this section again, though. because \code{StrMid} is just so very slow! Now I could of course hardcode a command that returns the correct character based on the argument, but isn't that a bit too cheaty? Maybe. But my program technically works, it's just too slow. If you want one that does not cheat, check out Sansero's repo.

\def\totalpos{3}
Hardcoded string char access: blubb \lucidcharat{\the\numexpr \totalpos - 0} blubb

\newcounter{tmpbctr}\setcounter{tmpbctr}{-1}
\loop
\stepcounter{tmpbctr}
\edef\tmpinput{\the\numexpr \value{tmpbctr} - 0}
%\edef\tmpchar{\noexpand\lucidcharat{\tmpinput}}
\def\tmpchar{\expandafter\lucidcharat\tmpinput}
(\tmpinput )[\tmpchar],
\ifnum \value{tmpbctr}<3
\repeat
\newline
The output should have been: \lucidcharat{0}, \lucidcharat{1}, \lucidcharat{2},\lucidcharat{3}

While working on this, I have found an understandable explanation for \code{\textbackslash expandafter}.\citelist{\cite{tugboat}}
But maybe that's not my problem. Maybe my problem is once again that I'm defining things in a loop.\citelist{\cite{macronamesloop} \cite{loopmathcal}} Maybe those approaches would be a good idea: Create distinct macros in each loop iteration instead of overwriting the same one each time (and failing at overwriting it).

But nevermind! It turns out I did everything well, except that I started my test output at a different index than I thought... the last few hours were spent on a ghost bug.

\makeatletter
\def\einput#1{\@@input #1 \space}
\newcommand{\showexpanded}[1]{%
  \everyeof{\expandafter\@gobble\noexpand}%
  \long\edef\@tempcontents{#1}%
  \show\@tempcontents
}
\newcommand{\justexpanded}[1]{%
  \everyeof{\expandafter\@gobble\noexpand}%
  \long\edef\@tempcontents{#1}%
  \@tempcontents
}
\makeatother
\def\testingfile{\einput{testing.tex}}
%\showexpanded{\testingfile}
%\justexpanded{\testingfile}
%\input{|"python -c "print(len('\hardcodedinput'));""}
%\hardcodedinput

\fi % endif ifrunshellex
\section{Get Head Performance}
Again, \texttt{xstring} is extremely slow with big strings. So I split everything into layers of 100 chars. But that's still noticeably slower at the end of the layer than at the start of the layer... even though it's only supposed to be a quick character access. So I'm transforming everything into head accesses at index zero.

\section{Scoping}
Nested loops require scoping around the inner loop. Which in turn means we need to use the \verb!\global!  keyword to assign to variables from outside the inner scope. And that in turn makes it really weird to use \texttt{StrGobbleLeft} from the \texttt{xstring} package when I'm trying to remove a character and store the result back in the same string.

The solution is probably a rewrite that uses only one loop plus an if condition that checks the modulus of the loop counter and acts appropriately whenever a layer is finished.

\section{Execution: Getting our Feet Wet}

We had \Strawberries\ Strawberries for this year's harvest. Probably not enough.
So we are sad now and solve https://adventofcode.com/2019/day/8.

% get first character of string hello
\getchar[hello]{1}
\getcoolchar[hello]{2}
%\firstchar{\include{inputfile}}

% compute integer arithmetic
\inteval{3 - 2}

% compute integer arithmetic
% "Although \relax does nothing by itself, it is a safe command to stop expansion of another command"
\newcommand\three{3}
\the\numexpr \three - 2 + 5 \relax
% and to store it in a variable???? redirection and then reusing \three does not work. We need a new variable.
\def\tmp{\three}
\def\four{\the\numexpr \tmp - 2 + 5 }

\newcommand\threehundred{300}

% include the input file
\ifdebug
  \def\inputstring{\input{debuginputfile.tex}}
  \def\inputstringlength{19}
\else
  \def\inputstring{\input{inputfile.tex}}
  \def\inputstringlength{15000}
\fi
% and print it
\inputstring

% include the input file in a different way because the previous way fails when passed as argument to getchar
\ifdebug
\newread\file
\openin\file=debuginputfile.tex
\read\file to \fileline
\closein\file
\else
\newread\file
\openin\file=inputfile.tex
\read\file to \fileline
\closein\file
\fi

hello world 
% get second character of inputfile
\getchar[\three]{1}
\getcoolchar[300]{1}
\getcoolchar[\threehundred]{1}
\typeout{===>"three"|\three}

% Variables given by the task
\newcount{\imgwidth}
\imgwidth=25
\newcount{\imgheight}
\imgheight=6
\ifdebug
\imgwidth=3
\imgheight=2
\fi

Image Width: \the\imgwidth \hspace{1cm}Image Height: \the\imgheight

% compute size of a layer
\newcount{\layersize}
\layersize=\the\imgwidth
\multiply\layersize by \imgheight \relax
\typeout{Size of a layer is \the\layersize}
I want to loop \the\layersize~times for the first layer.

% store the index of the best layer. The best layer has the fewest digits. So initialize the counter to maximum possible + 1.
\newcount\bestlayer
\bestlayer=-1
\newcount\bestlayerzerocount
\bestlayerzerocount=\inteval{\layersize + 1}
\global\newcount\currentlayerzerocount
\newcount\currentlayer

% now for the first layer count the number of zeros
\currentlayer=0
\currentlayerzerocount=0
\global\newcount\digitctr
\digitctr=0 % count from 1, not from zero. So we count from 1 to \layersize because we start advancing at the start of the loop.
% TODO: optimize getting current char by deleting from string.
%
\newcount\layerafterthelast

%%\StrLen{\fileline}[\stahp]%find the strlen and store it in \stahp
%% see https://tex.stackexchange.com/a/15424/102826
\def\stahp{\inputstringlength}

\def\stahpnow{\the\numexpr \stahp - 1}

The input file contains \stahpnow characters.

%ifrunpartone
\ifrunpartone
\section{ Execution: The Water Is Cold}
\begin{myquote}\begin{quote}
\texttt{\textbackslash global} is a TeX command that declares the following definition or assignment to be global, meaning that if TeX is currently inside a group, the definition or assignment will still remain valid when the group is over. Commands that can follow \texttt{\textbackslash global} include \texttt{\textbackslash def}, \texttt{\textbackslash edef}, \texttt{\textbackslash let}, \texttt{\textbackslash count}, \texttt{\textbackslash countdef}, [...]\citelist{\cite{wikibooksglobal}}\\
\end{quote}\end{myquote}
An alternative to using globals would be to use tikz loops with the \texttt{remember} option \citelist{\cite{tikzremember}}. Another option I see is using counters instead of counts - they are the latex version of the tex counter. For counters, you can apparently not use \texttt{\textbackslash the \textbackslash ctr}, you have to use\texttt{\textbackslash thectr} (See \autoref{c:simpleLoop}).
\begin{figure}
\begin{mycode}
\newcounter{outerloopcounter}
\setcounter{outerloopcounter}{0}
\loop
    	\addtocounter{outerloopcounter}{1}
           \theouterloopcounter ,
           \ifnum \value{outerloopcounter}<3
\repeat
outerloopcount: \theouterloopcounter
\end{mycode}
\caption{Simple Loop using TeX Counters}
\label{c:simpleLoop}
\end{figure}

Now let us do the same thing again, but with nested loops. See \autoref{c:nested}.
\begin{figure}[htbp]
\begin{mycode}
\newcounter{outerloopcounter}
\setcounter{outerloopcounter}{0}
\newcounter{innerloopcounter}
\loop
	\setcounter{innerloopcounter}{0}
    	\addtocounter{outerloopcounter}{1}
	
	{\loop
	\addtocounter{innerloopcounter}{1}
           (\theouterloopcounter , \theinnerloopcounter )
	\ifnum \value{innerloopcounter}<2
           \repeat }

           \ifnum \value{outerloopcounter}<3
\repeat
outerloopcount: \theouterloopcounter
\end{mycode}
\caption{Nested Loops using LaTeX Counters}
\label{c:nested}
\end{figure}
That requires curly braces around the inner loop. Otherwise, only the first outer loop iteration is run.

For the actual implementation, we assume that we are given \texttt{inputstringlength}, \texttt{imgwidth}, and \texttt{imgheight}. Computing those from the input string is feasible but takes long.

I'm using an \texttt{edef} to overwrite the \texttt{workingline} variable every loop.

% optimization because xstring library is slow.
% We remove the head of the input string once it has been used. This happens every time the layer has been read.
\def\workingline{\fileline}
%
\newcounter{layercounter}
\setcounter{layercounter}{0}
\newcounter{charinlayercounter}
\bigskip\noindent
\def\numlayers{\the\numexpr \inputstringlength / \layersize \relax}
Computation starting with \numlayers ~ Layers of size \the\imgwidth x\the\imgheight.
\newcounter{currentlayerzerocounter}\setcounter{currentlayerzerocounter}{0}
\newcounter{bestlayercounter}\setcounter{bestlayercounter}{0}
\newcounter{bestlayerzerocountcounter}\setcounter{bestlayerzerocountcounter}{\the\numexpr \layersize}
\newcounter{currentcharpos}\setcounter{currentcharpos}{\the\numexpr 0 - 1}
\newcounter{charstoremoveatendoflayer}\setcounter{charstoremoveatendoflayer}{0}

Normally, I would do a first loop for finding the best Layer and a second block for extracting the relevant information. However, given that the loops are so slow with all those string operations, I'll just spend some brain overhead and do this in one loop, even if it is a bit harder to keep the overview.\\

\newcounter{bestlayeronedigitscounter}
\newcounter{bestlayertwodigitscounter}
\newcounter{currentlayeronecounter}
\newcounter{currentlayertwocounter}

% loop through all layers
\loop
	% reset counters to start of layer
	\setcounter{charinlayercounter}{0}
    	\addtocounter{layercounter}{1}
	\setcounter{currentlayerzerocounter}{0}
	\setcounter{currentlayeronecounter}{0}
	\setcounter{currentlayertwocounter}{0}
	\setcounter{charstoremoveatendoflayer}{1}
	
	{\loop % loop through all characters in the current layer
	\addtocounter{charinlayercounter}{1}
	\addtocounter{currentcharpos}{1}
	\ifverbose
           (\thelayercounter , \thecharinlayercounter )
	\fi

	% For each character in the current layer
		% assign current char as head
	             \StrMid{\workingline}{1}{1}[\currentchar]
		% check if zero
		\IfEq {0}{\currentchar}{
		  \ifverbose
		  The current char \currentchar~ equals 0.
		  \fi
		  \addtocounter{currentlayerzerocounter}{1}
		  % if current layer is worse than the best, no need to proceed checking
		  \ifnum \value{currentlayerzerocounter} > \value{bestlayerzerocountcounter}
			\ifverbose
			Skipping Layer \thelayercounter~ because it has more zeros than (i.e. it is worse than) Layer ~\thebestlayercounter.
			\fi
			% normally, one character will be removed, but now we need to remove all that are remaining in the layer
			\setcounter{charstoremoveatendoflayer}{\numexpr \layersize - \value{charinlayercounter}}
			% trigger stop condition at end of inner loop
			\setcounter{charinlayercounter}{\layersize}
		  \fi
		}{ % else
		  \ifverbose
		  The current char \currentchar~does not equal 0.\\
		  \fi
                       \typeout{Msg from IFEQ ELSE branch}
		} % fi

		% check if one
		\IfEq {1}{\currentchar}{
		  \addtocounter{currentlayeronecounter}{1}
		}{}

		% check if two
		\IfEq {2}{\currentchar}{
		  \addtocounter{currentlayertwocounter}{1}
		}{}

		 % truncate inputstring by one character at head
          		\typeout{about to remove \thecharstoremoveatendoflayer ~chars from head}
		\ifverbose
          		About to remove \thecharstoremoveatendoflayer ~chars from head
		\fi
           	\StrGobbleLeft{\workingline}{\value{charstoremoveatendoflayer}}[\workinglinetwo]
		\typeout{Reached character at position \thecurrentcharpos}
                	\global\edef\workingline{\workinglinetwo}

	\ifnum \value{charinlayercounter}<\layersize
           \repeat }

	% update best layer
	\ifnum \value{currentlayerzerocounter} < \value{bestlayerzerocountcounter}
		\ifverbose
		New Best Layer is Layer \thelayercounter.
		\fi
		\typeout{New Best Layer is Layer \thelayercounter}
		\setcounter{bestlayercounter}{\value{layercounter}}
		\setcounter{bestlayerzerocountcounter}{\value{currentlayerzerocounter}}
		\setcounter{bestlayeronedigitscounter}{\value{currentlayeronecounter}}
		\setcounter{bestlayertwodigitscounter}{\value{currentlayertwocounter}}
	\fi

           \ifnum \value{layercounter}<\numlayers
\repeat
\typeout{fFinished computation for Pt 1}
outerloopcount: \thelayercounter\\
Best Layer: \thebestlayercounter ~with \thebestlayerzerocountcounter ~zeros.\\
It has \thebestlayeronedigitscounter ~Ones and \thebestlayertwodigitscounter ~Twos.\\
\edef\res{\numexpr \value{bestlayeronedigitscounter} * \value {bestlayertwodigitscounter}}
This is a total of $n_\text{ones} \cdot n_{\text{twos}} = \the\res$.
\ifdebug

This result is from debug values.
\fi
%
%endif runpartone
\fi\typeout{"Reached the end of ifrunpartone"}

\section{Day Eight Part Two: Because this task wasn't that hard}
\typeout{"debug Srk 1!"}
\begin{myquote}\begin{quote}
Each image layer consists of numbers that represent pixel information. One digit, one pixel.
\begin{align*}
0 & \rightleftarrows \text{black}\\
1 & \rightleftarrows \text{white}\\
2 & \rightleftarrows \text{transparent}\\
\end{align*}
You're given multiple layers. For each pixel coordinate pair $(x, y)$ find the \textit{first} nontransparent value.
\end{quote}\end{myquote}

\ifrunparttwo

\typeout{"Starting the Lord's work!"}
\def\numlayers{\the\numexpr \inputstringlength / \layersize \relax}
\newcounter{charcounter}\setcounter{charcounter}{0}
\newcounter{layercounterx}
\newcounter{pixelvalue}
\newcounter{totalpostmp}
\def\workingstr{\fileline}

\typeout{Pre-Loop}
\loop
\typeout{Debug Part Done}
  % actual part two
  \addtocounter{charcounter}{1}
  % for each pixel in the first layer, search all layers unti a pixel is opaque
           \setcounter{pixelvalue}{2}
	\setcounter{layercounterx}{-1}
	\typeout\edef{Outer Loop at charcounter \thecharcounter}
	{\loop
	  \addtocounter{layercounterx}{1}
		\def\totalpos{\numexpr \value{charcounter} + ( \value{layercounterx} * \layersize )}
		\setcounter{totalpostmp}{\totalpos}
		\typeout{Inner Loop (layerouncterx = \thelayercounterx) at totalpos \the\totalpos}
		%\StrMid{\workingstr}{\totalpos}{\inteval{\totalpos + 0}}[\currentchar]
\edef\tmpinput{\the\numexpr \value{totalpostmp} - 1}
\typeout{tmpinput is the index \tmpinput ~with meaning \meaning\tmpinput}
\def\tmpchar{\expandafter\lucidcharat\tmpinput}
\typeout{tmpchar is the character with meaning \meaning\tmpchar}
\edef\currentchar{\tmpchar}
\typeout{currentchar has meaning \meaning\currentchar}
\typeout{currchar is \the\numexpr \currentchar + 0 \relax}
		\setcounter{pixelvalue}{\inteval{\currentchar}}
		\typeout{Considering Layer \thelayercounterx ~for pixel \thecharcounter ~with value \thepixelvalue. Total layers is \numlayers}
		% if we reached the max layer and it's still 2, we keep the 2. But to abort the loop, we claim it's the magic number "minus one"
		\ifnum \inteval{\value{layercounterx}}=\inteval{\numlayers -1}
			\typeout{if layercounterx = numlayers - 1 }
			\ifnum \value{pixelvalue}=2
				\typeout{Setting pixelvalue to minus one}
				\setcounter{pixelvalue}{\inteval{0-1}}
			\fi
		\fi
	  \ifnum \value{pixelvalue} > \inteval{1}
	\repeat }
	% undo the hack from the inner loop:
	\ifnum \value{pixelvalue}=\inteval{\numexpr 0 - 1}
		\typeout{undoing hack...}
		\setcounter{pixelvalue}{2}
	\fi
	\typeout{Found \thepixelvalue in Layer \thelayercounterx for pixel \thecharcounter}
	\immediate\myappendxstring{\thepixelvalue}
\thepixelvalue
  \ifnum \value{charcounter} < \inteval{ \layersize}
\repeat

\else % elseif not runparttwo

\textbf{Not running part two (first try) as per flags} because compilation errors remain. See a later section for my second try.

\fi

% perform some magic https://tex.stackexchange.com/questions/402173/append-strings-to-a-variable-and-display-them-at-the-front-of-the-document
Let me just perform some magic - Consider \autoref{fig:magic}. There's only one problem with that: It assumes that  the input strings are constant. Since I input the value of a counter, mine are not, and the magical string that ends up being collected is just a repetition of the last value it had. Adding \texttt{\textbackslash immediate} and \texttt{\textbackslash edef} was not helpful.\citelist{\cite{collectvar} \cite{immediatez}}

\label{sec:magicexplain}Now of course, I don't actually need that collection - I can place my computation wherever I like. It would still have been cool though - partly because I have weird spacing when I output my computation character by character, and partly because this is a nice trick to have in my spellbook at the ready. Luckily, the author of that trick replied to my inquiry by adding an \code{\textbackslash edef} and some \cprotect\code{\verb|\expandafter|} (\autoref{fig:segletes}).

\begin{figure}[hp]
\begin{myquote}
@lucidbrot
\begin{lstlisting}[columns=fullflexible, backgroundcolor = \color{codebggray}]
\def\myappendxstring#1{
  \edef\tmp{#1}\expandafter\g@addto@macro%
    \expandafter\mystring\expandafter{\tmp}        }
\end{lstlisting}
Then, \begin{lstlisting}[columns=fullflexible, backgroundcolor = \color{codebggray}]
\stepcounter{mycounter} %
  \myappendxstring{Counter value is \themycounter. }
\end{lstlisting}
 - Steven B. Segletes 
\end{myquote}
\caption{S.B. Segletes' addition.}
\label{fig:segletes}
\end{figure}

%% display the computed variable here
%\makeatletter
%\@starttoc{xyz}% executes stuff in .xyz file
%\makeatother
%Magic: \thefinalstring
%% the following line must be performed at the end of the computation - e.g. at the end of the document.
%\addtocontents{xyz}{\gdef\protect\thefinalstring{\mystring}}

\begin{figure}[htbp]
\begin{samepage}
\begin{mycode}
% Throughout the document, collect the variable using
\myappendstring{hello}
% display the computed variable here
\makeatletter
\@starttoc{xyz}% executes stuff in .xyz file
\makeatother
\thefinalstring
% the following line must be performed at 
% the end of the computation - e.g. at the
% end of the document.
\addtocontents{xyz}{\gdef\protect\thefinalstring{\mystring}}
\end{mycode}
\caption{Magic to collect a variable, then print it at the start of the document. \citelist{\cite{collectvar}}}
\label{fig:magic}
\end{samepage}
\end{figure}

After playing around with creating my own command for accessing my input string quickly by index, I've come upon the problem that while it worked perfectly for printing the results to the PDF, it caused syntax errors when I tried to reuse the results. E.g. in another \code{\textbackslash edef} or \code{\textbackslash typeout}. I ended up asking about this on stackexchange and was explained that because \code{\textbackslash edef} evaluates its contents, if its argument contains another \code{\textbackslash edef} then it will evaluate to itself and the argument of the inner edef will be an undefined command. \citelist{\cite{fragilecommand}}

\begin{figure}[htbp]
\begin{myquote}
\begin{quote}
"If such claims sound too good to be true, keep in
mind that they were made by TEX’s designer, on a day when TEX happened to
be working, so the statements may be biased; but read on anyway."
\end{quote}
\end{myquote}
\caption{Donald Knuth displaying the mentality that TeX may sometimes choose not to work.\citelist{\cite{texbook}}}
\end{figure}

\section{Linux}
I've thought I'd continue working on this file in the train, on my laptop. Which uses Ubuntu instead of Windows. A quick
\begin{mycode}
sudo apt-get update
sudo apt-get install texlive-full texmaker
\end{mycode}
and a \code{git clone} later and I was almost set up.

Seems like my latex distribution or environment on Ubuntu behaves differently though. First of all, I had to remove an exclamation mark from the definition of my \code{mycode} environment for some reason. I hope it's still valid on Windows with MikTeX.
And I also had to set up the shell-escape again. It seems like I only have the option of always using it or never, as opposed to the dropdown list with custom options I have on windows. Also, I haven't figured out yet if I'm running the correct tools. On Windows, I'm doing a PdfLaTeX + MakeIndex + BibTex. That does not really exist on my Ubuntu, so I'm just doing PdfLaTeX only. I'll have to learn more about this.
But it actually seems like just using PdfLaTeX is enough for generating those citation entries.

Also, the error messages are more, and they are more pedantic/verbose. That could be helpful for debugging, but also annoying.
Searching for the first of those error messages in google led me to a valuable explanation about \href{http://www.texfaq.org/FAQ-extrabrace}{extra closing braces}.\citelist{\cite{endbrace}}

\begin{quote}
Argument of \textbackslash @newctr has an extra \}.$<$inserted text$>$\textbackslash par \textbackslash repeat
\end{quote}

Maybe I should consider all the warnings I'm getting without even running part two first? Maybe also not. They are all just either about design (overfull hbox, fonts) or warn about things that are like I want them to be. E.g. the abbreviation for one of the authors is undefined - but that's totally fine because this is not an abbreviation. It's the authors full name!

\section{Night Eight Part Two}
The same thing attempted again, after having gotten some help by D. Carlisle.\citelist{\cite{fragilecommand}}.

\ifrunparttwotrytwo

  % -----------------------------------------------------------
  \begin{figure}[hbp]
  debug for part two:
  \newcounter{debugctr}
  \setcounter{debugctr}{-1}
	{\loop
	\stepcounter{debugctr}
	\edef\tmpinput{\the\numexpr \value{debugctr} - 0}
	\def\tmpchar{\expandafter\lucidcharat\tmpinput}
	(\tmpinput)[\tmpchar],
	%\edef\tmpcharr{\tmpchar}
	\show\tmpchar
	\typeout{tmpchar is \tmpchar}
	\ifnum \value{debugctr}<3
	\repeat }
	
	\begin{mycode}
	
	\newcounter{debugctr}
    \setcounter{debugctr}{-1}
	{\loop
		\stepcounter{debugctr}
		\edef\tmpinput{\the\numexpr \value{debugctr} - 0}
		\def\tmpchar{\expandafter\lucidcharat\tmpinput}
		(\tmpinput)[\tmpchar],
		%\edef\tmpcharr{\tmpchar}
		\show\tmpchar
		\typeout{tmpchar is \tmpchar}
		\ifnum \value{debugctr}<3
		\repeat }
	\end{mycode}
  \caption{Fetching characters in the input string by index.}
  \label{fig:hardcodinglucidcharat}
  \end{figure}
  % -----------------------------------------------------------
  
  We already have in \autoref{fig:hardcodinglucidcharat} the accessor macro for the input string that even works in a loop. Now let's go!
  
  Somehow... I managed to write a command that can be typeout without compiler error if and only if the result is written to the pdf first.
  
  \begin{figure}[htbp]
  \begin{mycode}
  Pre-Loop
Outer Loop at charcounter 1
Inner Loop (layerouncterx = 0) at totalpos 1
tmpchar is the character with meaning macro:->\expandafter \lucidcharat \tmpinp
ut
tmpchar has value  \edef 0{0} \relax 1
\end{mycode}
\caption{Log File}
\label{fig:blu}
\end{figure}

The log (\autoref{fig:blu}) indicates that my command \code{\textbackslash lucidcharat} is not doing what it's supposed to be anyway. It contains the line \code{\textbackslash edef\textbackslash tmpp{\#1}} which should not evaluate \code{\textbackslash tmpp} to \code{0}.

  
\typeout{"Starting the Lord's work!"}
\def\numlayers{\the\numexpr \inputstringlength / \layersize \relax}
\newcounter{charcounter}\setcounter{charcounter}{0}
\newcounter{layercounterx}
\newcounter{pixelvalue}
\newcounter{totalpostmp}
\def\workingstr{\fileline}
% breaking condition for debugging
\newif\ifbreakonunexpected
\breakonunexpectedtrue
% count for formatted printing
\newcounter{fpfctr}
\setcounter{fpfctr}{0}

\typeout{Pre-Loop}
\begin{center}
\textbf{The Image}
%(See \autoref{fig:imgcomp}.)
\end{center}
%\begin{figure}
\loop
ggg%
% actual part two
\addtocounter{charcounter}{1}%
% for each pixel in the first layer, search all layers unti a pixel is opaque
\setcounter{pixelvalue}{2}%
\setcounter{layercounterx}{-1}%
\typeout{Outer Loop at charcounter \thecharcounter}%
{\loop%
hhh%
\stepcounter{layercounterx}%
\def\totalpos{\numexpr \value{charcounter} + ( \value{layercounterx} * \layersize )}%
\setcounter{totalpostmp}{\totalpos}%
\typeout{Inner Loop (layerouncterx = \thelayercounterx) at totalpos \the\totalpos}%
\edef\tmpinput{\the\numexpr \value{totalpostmp} - 1}%
\def\tmpchar{\lucidcharat{\tmpinput}}%%%(\tmpinput)[\tmpchar],
iii%
\typeout{tmpchar is the character with meaning \meaning\tmpchar}
\typeout{tmpchar for index \tmpinput{} has value \tmpchar}
\edef\currentchar{\tmpchar}aaa%
\typeout{currentchar has meaning \meaning\currentchar}%
\typeout{currchar is \the\numexpr \currentchar + 0 \relax}%
\setcounter{pixelvalue}{\inteval{\currentchar}}%
\typeout{Considering Layer \thelayercounterx{} for pixel \thecharcounter{} with value \thepixelvalue{}. Total layers is \numlayers}%
% if we reached the max layer and it's still 2, we keep the 2. But to abort the loop, we claim it's the magic number "minus one"
\ifnum \inteval{\value{layercounterx}}=\inteval{\numlayers -1}
\typeout{if layercounterx = numlayers - 1 (Value of pixelvalue is \thepixelvalue) }
\ifnum \value{pixelvalue}=2
\typeout{Setting pixelvalue to minus one}
\setcounter{pixelvalue}{\inteval{0-1}}
\fi
bbb%
\fi
% break loop if value is unexpectedly more than one character
\ifbreakonunexpected
\ifnum \inteval{\tmpchar}>9
% pixelvalue should never be negative. So when we set it to -9, it means something is off
\setcounter{pixelvalue}{-9}%
\typeout{breaking on unexpected value \tmpchar .}%
\else
\typeout{value \tmpchar ~was expected as it is < 9.}
\fi%
\fi%
\ifnum \value{pixelvalue} > \inteval{1}
\repeat }
% undo the hack from the inner loop:
\ifnum \value{pixelvalue}=\inteval{\numexpr 0 - 1}
\typeout{undoing hack...}
\setcounter{pixelvalue}{2}
ccc%
\fi
ddd%
\typeout{Found \thepixelvalue in Layer \thelayercounterx for pixel \thecharcounter}
\immediate\myappendxstring{\thepixelvalue}
% print pixel value
\thepixelvalue
\stepcounter{fpfctr}
% if the counter % imagewidth == 0 then newline
\ifnum \value{fpfctr}=\inteval{25}
\setcounter{fpfctr}{0}\\
\fi%
eee%
%
% abort if something went wrong
\ifnum \value{pixelvalue}=-9
\setcounter{charcounter}{\layersize}%
\typeout{Aborting due to unexpected value.}%
Aborting due to unexpected value.
\fi%
fff%
\ifnum \value{charcounter} < \inteval{ \layersize}%
\repeat
%\caption{The whole image computation happened within this figure. Here it is, formatted as an image.}
%\label{fig:imgcomp}
%\end{figure}
  
For an explanation of the following magic, see \autoref{fig:segletes} in \autoref{sec:magicexplain}. It concatenates a string in a loop.

If the magic looks wrong, you might need to run the computation twice. Or just look at \code{day8.xyz}'s content.
  
% display the computed variable here
\makeatletter
\@starttoc{xyz}% executes stuff in .xyz file
\makeatother
Magic: \thefinalstring
% the following line must be performed at the end of the computation - e.g. at the end of the document.
\addtocontents{xyz}{\gdef\protect\thefinalstring{\mystring}}

Reminder that the image has $\the\imgwidth \times \the\imgheight$ pixels.

\else
\textbf{Not running part two (second try) as per flags.}
\fi

\section{Todo}
Once this is done, I should inform the person who said I should inform them once this is done, to be found at \href{https://twitter.com/LucidBrot/status/1290792953548615682}{Twitter}.

Re-enable \code{\textbackslash runshellex}.

cite sansero

I want to attach the source code to this file.

Fix segletes figure quote.

I also want ot measure how long this takes. See \href{https://tex.stackexchange.com/questions/505770/how-to-measure-the-compilation-time-of-a-document?rq=1}{here for example}.
\section{Performance}
I have tried to measure the time of my code using the \code{l3benchmark} package. But including this package failed because LaTeX thinks my PC has no clock.
PDF Elapsed Time in seconds: \the\numexpr \pdfelapsedtime / 65536 \relax ~seconds
\begin{myquote}\begin{quote}
The value of \code{\textbackslash pdfelapsedtime} is the number of seconds elapsed multiplied by 65536. \citelist{\cite{robertson}}
\end{quote}\end{myquote}

\section{Source}
The source code is clingy: It attached itself to this file. Open it in Adobe Reader and view it under Attachments.\\
Linking to it does not work unless the file is also a pdf, it seems.

\section{Fun Facts}
Read \citelist{\cite{ifnumdanger}} for a good warning about using percentage signs at the end of \code{ifnum} statements. The most intriguing part is displayed in \autoref{fig:dangernoodle}.

Another interesting thing about \autoref{fig:dangernoodle} is that it displays very badly unless preceeded by a \code{\textbackslash pagebreak}, \code{\textbackslash newline}, or \code{\textbackslash clearpage} \citelist{\cite{paging}}. I'm curious to see if the addition of this paragraph outlining that changes this fact (due to page break positioning).
Indeed it turns out that the figure is now displayed correctly without need for a manual page break. Maybe this is because it is now placed "here" instead of on a new page? Nope! Placing it on its own page is okay, this time. I think I won't ever figure this out.

%\pagebreak
%\newpage
\begin{figure}[hbtp]
\begin{myquote}
\begin{quote}
\begin{lstlisting}[columns=fullflexible, backgroundcolor = \color{codebggray}]
\ifnum1=0%
  \ifnum2=2
    1%
  \else
    2%
  \fi
  a%
\else
  b%
\fi
\end{lstlisting}
produces a, instead of b, as someone that took a quick glance at the \textbackslash ifnum1=0 would guess. If, however, you remove the very first \%, the output is b.
\end{quote}
\end{myquote}
\caption{The dangers of comments.}
\label{fig:dangernoodle}
\end{figure}

\begin{bibdiv}
\begin{biblist}
%\bib{Bourbaki70}{book}{
%title={Theorie des ensembles},
%author={Bourbaki, Nicolas},
%date={1970},
%publisher={Hermann},
%address={Paris}
%}
%\bib{Sokal96}{article}{
%title={Trangressing the boundaries},
%subtitle={Toward a transformative hermeneutics of quantum gravity},
%author={Sokal, Alan},
%journal={Social Text},
%volume={46/47},
%date={1996},
%pages={217--252}
%}
\bib{Gonzalo}{webpage}{
title={Nest StrLen and ifthenelse commands},
author={Medina, Gonzalo},
url={https://tex.stackexchange.com/a/15424/102826},
accessdate={05.08.2020}
}
\bib{shellescape}{webpage}{
title={texify.exe in TeXworks in MSWindows 10: MiKTex encountered internal error when compile with --shell-escape},
author={Desyllas, Dimitrios},
url={https://tex.stackexchange.com/a/437933/1028266},
accessdate={05.08.2020}
}
\bib{pythonescape}{webpage}{
title={Combining \LaTeX with Python},
author={Ziegenhagen, Uwe},
url={https://tug.org/tug2019/slides/slides-ziegenhagen-python.pdf},
date={09.08.2019},
accessdate={05.08.2020}
}
\bib{stackexpand}{webpage}{
title={Why is everyeof needed to avoid...},
author={Gross, Jason},
url={https://tex.stackexchange.com/q/516031/102826},
accessdate={07.08.2020}
}
\bib{wikibooksglobal}{webpage}{
title={TeX/global},
author={Burk},
url={https://en.wikibooks.org/wiki/TeX/global},
accessdate={21.08.2020}
}
\bib{tikzremember}{webpage}{
title={Setting a Global Variable in TikZ Loop},
author={cfr},
url={https://tex.stackexchange.com/a/436829/102826},
accessdate={21.08.2020}
}
\bib{collectvar}{webpage}{
title={Append strings to a variable and display them at the front of the document},
author={Segletes, Steven B.},
url={https://tex.stackexchange.com/a/402174/102826},
accessdate={25.08.2020}
}
\bib{immediatez}{webpage}{
title={What are \textbackslash immediate \& \textbackslash write18 and how does one use them?},
author={Wright, Joseph},
url={https://tex.stackexchange.com/a/20446/102826},
accessdate={25.08.2020}
}
\bib{robertson}{webpage}{
title={Are there LaTeX performance profiling tools?},
author={Robertson, Will},
url={https://tex.stackexchange.com/a/547/102826},
accessdate={25.08.2020}
}
\bib{tugboat}{webpage}{
title={A tutorial on \textbackslash expandafter},
author={v. Bechtolsheim, Stefan},
url={https://www.tug.org/TUGboat/tb09-1/tb20bechtolsheim.pdf},
accessdate={28.08.2020}
}
\bib{macronamesloop}{webpage}{
title={Defining and expanding macros In loops},
author={cgnieder and Sebastian},
url={https://tex.stackexchange.com/a/312177/102826},
accessdate={28.08.2020}
}
\bib{loopmathcal}{webpage}{
title={Defining new commands inside a for loop},
author={Carlisle, David},
url={https://tex.stackexchange.com/a/57037/102826},
accessdate={28.08.2020}
}
\bib{endbrace}{webpage}{
title={An extra \}?},
author={Unknown},
url={http://www.texfaq.org/FAQ-extrabrace},
accessdate={28.08.2020}
}
\bib{fragilecommand}{webpage}{
title={How to use xstring IfEq inside command?},
author={Carlisle, David},
author={LucidBrot},
url={https://tex.stackexchange.com/a/561561/102826},
accessdate={06.09.2020}
}
\bib{texbook}{book}{
title={The TeXbook},
author={Knuth, Donald E.},
note={http://visualmatheditor.equatheque.net/doc/texbook.pdf},
accessdate={07.09.2020},
year={1984},
pages={6}
}
\bib{ifnumdanger}{webpage}{
title={How to compare number from \textbackslash newenvironment argument},
author={Oleynik, Phelype},
author={Brasil},
url={https://tex.stackexchange.com/a/460014/102826},
accessdate={07.09.2020},
}
\bib{paging}{webpage}{
title={Comparison between \textbackslash newpage, \textbackslash clearpage and \textbackslash pagebreak, etc.?},
author={wonderich},
author={egreg},
url={https://tex.stackexchange.com/a/497776/102826},
accessdate={08.09.2020},
}
\end{biblist}
\end{bibdiv}


\end{document}