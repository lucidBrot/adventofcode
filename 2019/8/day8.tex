\documentclass{article} \usepackage[utf8]{inputenc}
\usepackage{xstring}
\usepackage{calc, xintexpr}
\usepackage{xfp}
\usepackage{pdftexcmds}
\usepackage{coolstr}

% TeX docs at http://pgfplots.sourceforge.net/TeX-programming-notes.pdf

% TODO: https://tex.stackexchange.com/questions/29402/how-do-i-make-my-document-look-like-it-was-written-by-a-cthulhu-worshipping-madm
% cool hack: http://texhacks.blogspot.com/2010/12/forcing-full-expansion.html

\newif\ifcomputationenabled
\computationenabledtrue
\newif\ifdebug
\debugtrue

\title{Advent of Code\\
{\large Day Eight}}
\author{LucidBrot} \date{August 2020}
\input{input.tex}

% https://tex.stackexchange.com/a/7183/102826
% if is num, emphasize, else ignore.
\def\isnum#1{%
  \if!\ifnum9<1#1!\else_\fi
    \emph{#1}\else#1\fi}


\newcommand{\firstchar}[1]{%
    \StrLeft{#1}{1}[\firstletter]%
    \firstletter
}

% documentation: \getchar[hello]{5}   is 'h'
\def\getchar[#1]#2{%
\StrMid{#1}{#2}{\numexpr #2 + 0\relax}[\mychar]%
\mychar}

% same as getchar but maybe it works when used in string comparison?
\def\getcoolchar[#1]#2{%
\substr{#1}{#2}{1}%
}
% NOPE! It's just as broken, just in a different way. it works as long as the first argument is a string. but if it's a command... then it returns the whole thing as first character.

% https://tex.stackexchange.com/questions/195491/ifthenelse-equal-string-comparison-fails
\makeatletter
\newcommand\strcmptozero[1]{%
  \ifnum\pdf@strcmp{\unexpanded{#1}}{0}=0 %
     \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
    {TRUE}
    {FALSE}%
}
\makeatother


\begin{document}


\maketitle

\section{Introduction}

We had \Strawberries\ Strawberries for this year's harvest. Probably not enough.
So we are sad now and solve https://adventofcode.com/2019/day/8.

% get first character of string hello
\getchar[hello]{1}
\getcoolchar[hello]{2}
%\firstchar{\include{inputfile}}

% compute integer arithmetic
\inteval{3 - 2}

% compute integer arithmetic
% "Although \relax does nothing by itself, it is a safe command to stop expansion of another command"
\newcommand\three{3}
\the\numexpr \three - 2 + 5 \relax
% and to store it in a variable???? redirection and then reusing \three does not work. We need a new variable.
\def\tmp{\three}
\def\four{\the\numexpr \tmp - 2 + 5 }

\newcommand\threehundred{300}

% include the input file
\ifdebug
  \def\inputstring{\input{debuginputfile.tex}}
\else
  \def\inputstring{\input{inputfile.tex}}
\fi
% and print it
\inputstring

% include the input file in a different way because the previous way fails when passed as argument to getchar
\ifdebug
\newread\file
\openin\file=debuginputfile.tex
\read\file to \fileline
\closein\file
\else
\newread\file
\openin\file=inputfile.tex
\read\file to \fileline
\closein\file
\fi

hello world 
% get second character of inputfile
\getchar[\three]{1}
\getcoolchar[300]{1}
\getcoolchar[\threehundred]{1}
\typeout{===>"three"|\three}

% Variables given by the task


% variables given by the task:
\newcount{\imgwidth}
\imgwidth=25
\newcount{\imgheight}
\imgheight=6
\ifdebug
\imgwidth=3
\imgheight=2
\fi

Image Width: \the\imgwidth \hspace{1cm}Image Height: \the\imgheight

% compute size of a layer
\newcount{\layersize}
\layersize=\the\imgwidth
\multiply\layersize by \imgheight \relax
\typeout{Size of a layer is \the\layersize}
I want to loop \the\layersize~times for the first layer.

% store the index of the best layer. The best layer has the fewest digits. So initialize the counter to maximum possible + 1.
\newcount\bestlayer
\bestlayer=-1
\newcount\bestlayerzerocount
\bestlayerzerocount=\inteval{\layersize + 1}
\global\newcount\currentlayerzerocount
\newcount\currentlayer

% now for the first layer count the number of zeros
\currentlayer=0
\currentlayerzerocount=0
\global\newcount\digitctr
\digitctr=0 % count from 1, not from zero. So we count from 1 to \layersize because we start advancing at the start of the loop.
% TODO: optimize getting current char by deleting from string.
%
\newcount\layerafterthelast

\StrLen{\fileline}[\stahp]%find the strlen and store it in \stahp
% see https://tex.stackexchange.com/a/15424/102826

The input file contains \inteval{\stahp - 1} characters.
%flag condition to skip long computation for debugging layout
\ifcomputationenabled
% Aand now repeat the inner loop below once per layer. 

\loop
	{\loop
	  \message{\the\digitctr}
	  \global \advance \digitctr by1
	  % assign current char
             \StrMid{\fileline}{\digitctr}{\numexpr \digitctr + 0\relax}[\currentchar]

	  % check if zero
            \IfEq {0}{\currentchar}{
	    \global \advance \currentlayerzerocount by1
	    Advanced currentlayerzerocount to \the\currentlayerzerocount~for layer \the\currentlayer.
	    % if the zerocount is not optimal, abort early
	    \ifnum \currentlayerzerocount<\inteval{\bestlayerzerocount}
	      % continue as normal
                \message{Everything is fine with digitcounter \the\digitctr}
	    \else
	      % abort and check next layer
	      % for this we set the counter to the first character index of the next layer
	      \digitctr={\the\numexpr \layersize * \currentlayer + \layersize}
	      \message{Digitcounter reset to \the\digitctr}
	Layer \the\currentlayer has more zeros than the current best layer (\the\bestlayer ) so we skip ahead to character at index \the\digictr to start the next layer.\\
	    \fi
             }{%else
                The current char \currentchar~does not equal 0.\\
                \message{Msg from IFEQ ELSE branch}
	 }%fi
	\ifnum \digitctr<\inteval{\layersize * \currentlayer + \layersize}
	\repeat
         }%
\message{Finished inner loop}
	% if there were very little zeros, we can update the best layer
	\ifnum \currentlayerzerocount<\bestlayerzerocount
	  \bestlayer=\currentlayer
	  \bestlayerzerocount=\currentlayerzerocount
             Found a new best layer (\the\bestlayer) with zerocount \the\bestlayerzerocount.\\
\message{Found a new best layer \the\bestlayer}
          \else
             Current Layer (\the\currentlayer) with zerocount \the\currentlayerzerocount~is worse than Best Layer (\the\bestlayer, zerocount \the\bestlayerzerocount).\\
\message{Layer \the\currentlayer is not a new best layer.}
	\fi
          Best Layer Zero Count is \the\bestlayerzerocount~for layer \the\bestlayer. \\
\ifnum \digitctr<\stahp
	\currentlayerzerocount=0
	\advance \currentlayer by1
	Advanced currentlayer to \the\currentlayer.\\
\repeat

The current layer is now \the\currentlayer

% end of flag condition to skip long computation for debugging layout
\fi



\end{document}